---
/**
 * Hero Module - Consultancy Skin
 * 
 * ENGINE CONTRACT:
 * - Reads: operator.brand, operator.hero, operator.ui, operator.proof
 * - Skin defaults: consultancyDefaults.nav, consultancyDefaults.labels.hero, consultancyDefaults.cta
 * 
 * TOKEN DEPENDENCIES:
 * - --color-bg-base, --color-bg-offset, --color-bg-inverse
 * - --color-text-primary, --color-text-secondary, --color-text-muted, --color-text-inverse
 * - --color-border, --color-border-strong
 * - --color-accent, --color-hover-bg
 * 
 * VISUAL METAPHOR: Systems / Architecture / Grid
 * Swiss-minimal aesthetic with precise typography and grid-based layouts.
 */

import { consultancyDefaults } from '../skin';

interface Props {
  operator: any;
  variant?: string;
}

const { operator } = Astro.props;

// === BRAND (from operator.brand) ===
const operatorName = operator.brand?.name ?? 'Operator';
const verticalShort = operator.vertical ?? 'consultancy';

// === HERO CONTENT (from operator.hero) ===
const headline = operator.hero?.headline ?? 'Outcomes';
const headlineAccent = operator.hero?.headlineAccent ?? 'by Design.';
const positioning = operator.hero?.subhead ?? operator.hero?.paragraph ?? '';

// === CTAs (operator.hero.cta → operator.ui.cta → skin defaults) ===
const ctaPrimary = operator.hero?.cta?.primary ?? operator.ui?.cta?.primary ?? consultancyDefaults.cta.primary;
const ctaSecondary = operator.hero?.cta?.secondary ?? operator.ui?.cta?.secondary ?? consultancyDefaults.cta.secondary;
const ctaStartHere = operator.ui?.cta?.startHere ?? consultancyDefaults.cta.startHere;

// === METRICS (operator.hero.stats → operator.proof metrics fallback) ===
const metrics: any[] =
  operator.hero?.stats ??
  (operator.proof ?? []).filter((p: any) => p.type === 'metric').slice(0, 4);

// === FOUNDER (featured founder for hero display) ===
const featuredFounder = operator.founders?.find((f: any) => f.featured) ?? operator.founders?.[0];

// === NAV LINKS (operator.ui.nav → skin defaults) ===
const navLinks = operator.ui?.nav ?? consultancyDefaults.nav;

// === LABELS (operator.ui.labels.hero → skin defaults) ===
const metricsLabel = operator.ui?.labels?.hero?.metrics ?? consultancyDefaults.labels.hero.metrics;
---

<!-- NAV (FIXED) -->
<nav class="fixed top-0 w-full z-50 bg-[var(--color-bg-base)]/95 backdrop-blur-nav border-b border-[var(--color-border)]">
  <div class="max-w-[1200px] mx-auto px-4 lg:px-10 h-16 flex justify-between items-center">
    <div class="font-bold text-base tracking-tight text-[var(--color-text-primary)]">
      {operatorName} <span class="text-[var(--color-text-muted)] font-normal">/ {verticalShort}</span>
    </div>

    <div class="hidden md:flex gap-8 font-mono text-[10px] uppercase tracking-[0.12em] text-[var(--color-text-muted)]">
      {navLinks.map((link: { label: string; href: string }) => (
        <a 
          href={link.href} 
          class="hover:text-[var(--color-text-primary)] transition-colors duration-200 py-2"
        >
          {link.label}
        </a>
      ))}
    </div>

    <a 
      href="#conversion" 
      class="bg-[var(--color-bg-inverse)] text-[var(--color-text-inverse)] px-5 py-2 text-[10px] font-bold uppercase tracking-[0.1em] hover:opacity-90 transition-all duration-200"
    >
      {ctaStartHere}
    </a>
  </div>
</nav>

<!-- HERO SECTION -->
<section id="hero" class="pt-20 pb-2 relative bg-[var(--color-bg-base)]">
  <div class="max-w-[1200px] mx-auto px-4 lg:px-10 grid grid-cols-1 lg:grid-cols-12 gap-4 lg:gap-10">
    <!-- Main Content -->
    <div class="lg:col-span-7 xl:col-span-8">
      <h1 class="text-[clamp(2.75rem,7vw,5.5rem)] font-black tracking-[-0.04em] leading-[0.92] text-balance">
        <span class="text-[var(--color-text-primary)]">{headline}</span><br />
        <span class="text-[var(--color-accent)]">{headlineAccent}</span>
      </h1>

      {positioning && (
        <p class="mt-6 max-w-lg text-base md:text-lg text-[var(--color-text-secondary)] leading-[1.65] border-l-2 border-[var(--color-accent)] pl-4">
          {positioning}
        </p>
      )}

      <div class="mt-8 flex flex-wrap gap-0 border border-[var(--color-bg-inverse)] w-fit">
        <a 
          href="#products" 
          class="bg-[var(--color-bg-inverse)] text-[var(--color-text-inverse)] px-6 py-3.5 text-[10px] uppercase tracking-[0.1em] font-bold hover:opacity-90 transition-all duration-200 flex items-center gap-2"
        >
          {ctaPrimary}
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </a>
        <a 
          href="#tools" 
          class="px-6 py-3.5 text-[10px] uppercase tracking-[0.1em] font-bold border-l border-[var(--color-bg-inverse)] text-[var(--color-text-primary)] hover:bg-[var(--color-hover-bg)] transition-all duration-200"
        >
          {ctaSecondary}
        </a>
      </div>
    </div>

    <!-- Authority Panel -->
    <div class="lg:col-span-5 xl:col-span-4 bg-[var(--color-bg-offset)] border border-[var(--color-border)] relative overflow-hidden">
      <div class="absolute top-0 left-0 w-full h-1 bg-[var(--color-accent)]"></div>
      
      {/* Founder Section - Large Hero Image */}
      {featuredFounder && (
        <div class="relative">
          {/* Large Founder Image */}
          <div class="relative aspect-[4/5] w-full overflow-hidden">
            <img 
              src={featuredFounder.avatar} 
              alt={featuredFounder.avatarAlt ?? `${featuredFounder.name} - ${featuredFounder.title}`}
              class="w-full h-full object-cover object-top"
            />
            {/* Gradient Overlay */}
            <div class="absolute inset-0 bg-gradient-to-t from-[var(--color-bg-inverse)]/90 via-[var(--color-bg-inverse)]/20 to-transparent"></div>
            
            {/* Founder Info - Overlaid on Image */}
            <div class="absolute bottom-0 left-0 right-0 p-6 text-white">
              <p class="font-bold text-xl lg:text-2xl leading-tight">
                {featuredFounder.name}
              </p>
              <p class="text-xs font-mono uppercase tracking-[0.1em] mt-1 text-white/70">
                {featuredFounder.title}
              </p>
              {featuredFounder.shortBio && (
                <p class="text-sm text-white/80 mt-3 leading-relaxed">
                  {featuredFounder.shortBio}
                </p>
              )}
              
              {/* Credentials + Socials Row */}
              <div class="flex items-center justify-between mt-4 pt-4 border-t border-white/20">
                {featuredFounder.credentials && featuredFounder.credentials.length > 0 && (
                  <div class="flex flex-wrap gap-2">
                    {featuredFounder.credentials.slice(0, 2).map((cred: string) => (
                      <span class="text-[9px] font-mono uppercase tracking-[0.05em] px-2 py-1 bg-white/10 backdrop-blur-sm text-white/90">
                        {cred}
                      </span>
                    ))}
                  </div>
                )}
                {featuredFounder.socials && (
                  <div class="flex gap-3">
                    {featuredFounder.socials.linkedin && (
                      <a href={featuredFounder.socials.linkedin} target="_blank" rel="noopener noreferrer" class="text-white/60 hover:text-white transition-colors">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                      </a>
                    )}
                    {featuredFounder.socials.twitter && (
                      <a href={featuredFounder.socials.twitter} target="_blank" rel="noopener noreferrer" class="text-white/60 hover:text-white transition-colors">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                      </a>
                    )}
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Metrics Section - Compact Grid Below Image */}
      <div class="py-2 px-4 bg-[var(--color-bg-base)]">
        <div class="grid grid-cols-3 gap-4">
          {metrics.length > 0 ? (
            metrics.slice(0, 3).map((m: any) => (
              <div class="text-center">
                <p class="text-xl lg:text-2xl font-black tracking-tight text-[var(--color-text-primary)]">
                  {m.value ?? m.metric ?? m.label}
                </p>
                <p class="text-[8px] text-[var(--color-text-muted)] font-mono uppercase tracking-[0.06em] mt-1">
                  {m.label ?? m.name ?? ''}
                </p>
              </div>
            ))
          ) : (
            <div class="col-span-3 text-sm text-[var(--color-text-muted)]">
              <span>Add metrics in </span>
              <code class="font-mono bg-[var(--color-bg-surface)] px-1.5 py-0.5 text-xs border border-[var(--color-border)]">hero.stats</code>
            </div>
          )}
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* Refine engine-grid for hero - uses CSS var for theming */
  .engine-grid {
    background-image:
      linear-gradient(to right, var(--color-border) 1px, transparent 1px),
      linear-gradient(to bottom, var(--color-border) 1px, transparent 1px);
    background-size: 80px 80px;
    opacity: 0.4;
  }
</style>
