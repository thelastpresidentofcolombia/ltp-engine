---
/**
 * Proof Module - Fitness/Coaching Skin
 * 
 * ENGINE CONTRACT:
 * - Reads: operator.proof (array of proof items)
 * - Skin defaults: fitnessDefaults.labels.proof
 * 
 * Supports: metrics, transformations, testimonials
 * Horizontal scrolling carousel with glass cards.
 * No avatars/images - easier to maintain.
 */

import { fitnessDefaults } from '../skin';

interface Props {
  operator: any;
  variant?: string;
}

const { operator } = Astro.props;

// === LABELS ===
const labels = operator.ui?.labels?.proof ?? fitnessDefaults.labels.proof;
const kicker = labels.kicker ?? 'Real Results';
const sectionTitle = labels.title ?? 'Track Record';
const subhead = labels.subhead ?? 'Transformations and outcomes from our community.';

// === PROOF ITEMS ===
const proofItems = operator.proof ?? [];

// Separate by type
const metrics = proofItems.filter((p: any) => p.type === 'metric');
const transformations = proofItems.filter((p: any) => p.type === 'transformation');
const testimonials = proofItems.filter((p: any) => p.type === 'testimonial');

// Combine testimonials + transformations for carousel
const reviewCards = [...transformations, ...testimonials];
---

<style>
  .glass-card {
    background: var(--color-glass-surface, rgba(255,255,255,0.03));
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    border: 1px solid var(--color-glass-border, rgba(255,255,255,0.08));
  }
  .accent-hover {
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }
  .accent-hover:hover {
    border-color: color-mix(in srgb, var(--color-accent, #ccff00) 30%, transparent);
    box-shadow: 0 0 40px rgba(204,255,0,0.08);
  }
  .scroll-container {
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  .scroll-container::-webkit-scrollbar {
    display: none;
  }
  .nav-btn {
    border: 1px solid rgba(255,255,255,0.2);
    transition: all 0.3s ease;
  }
  .nav-btn:hover {
    background: var(--color-accent, #ccff00);
    color: black;
    border-color: var(--color-accent, #ccff00);
  }
</style>

<section id="proof" class="py-20 md:py-28 border-t border-white/5 bg-[color-mix(in_srgb,var(--color-bg-surface,#080808)_95%,#000)] relative z-10">
  <div class="max-w-[1400px] mx-auto px-4 md:px-6">
    
    <!-- Header -->
    <div class="mb-10 md:mb-12" data-aos="fade-up">
      <span 
        class="text-[10px] uppercase tracking-widest font-bold"
        style="color: var(--color-accent, #ccff00);"
      >
        {kicker}
      </span>
      <h2 class="font-[var(--font-display)] text-3xl md:text-5xl lg:text-6xl mt-3 text-white">
        {sectionTitle}
      </h2>
      <p class="text-[var(--color-text-secondary)] mt-3 max-w-xl text-sm md:text-base">
        {subhead}
      </p>
    </div>

    <!-- Metrics row (if any) -->
    {metrics.length > 0 && (
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10" data-aos="fade-up">
        {metrics.map((metric: any) => (
          <div class="glass-card rounded-[var(--radius-xl,16px)] p-6 text-center">
            <p 
              class="font-[var(--font-display)] text-3xl md:text-4xl"
              style="color: var(--color-accent, #ccff00);"
            >
              {metric.value}
            </p>
            <p class="text-xs text-[var(--color-text-secondary)] uppercase tracking-wider mt-2">
              {metric.label}
            </p>
            {metric.context && (
              <p class="text-[10px] text-[var(--color-text-muted)] mt-1">
                {metric.context}
              </p>
            )}
          </div>
        ))}
      </div>
    )}

    <!-- Carousel with nav buttons inline -->
    <div class="relative" data-aos="fade-up">
      <!-- Nav buttons - only show if more than 3 cards -->
      {reviewCards.length > 3 && (
        <div class="flex gap-3 justify-end mb-4">
          <button class="nav-btn w-10 h-10 rounded-full flex items-center justify-center text-white text-sm" id="proof-prev" aria-label="Previous">
            ←
          </button>
          <button class="nav-btn w-10 h-10 rounded-full flex items-center justify-center text-white text-sm" id="proof-next" aria-label="Next">
            →
          </button>
        </div>
      )}

      <!-- Cards - centered grid if 3 or less, scrollable carousel if more -->
      {reviewCards.length <= 3 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 justify-items-center">
          {reviewCards.map((item: any) => (
            <div class="w-full max-w-[400px] glass-card accent-hover p-6 rounded-[var(--radius-2xl,24px)] flex flex-col">
              {/* Author - no image, just name badge */}
              <div class="flex items-center justify-between mb-5">
                <div>
                  <p class="text-white font-bold text-base">{item.author}</p>
                  <p class="text-xs text-[var(--color-text-muted)]">{item.role}</p>
                </div>
                {item.rating && (
                  <div class="text-[var(--color-accent)] text-sm">
                    {'★'.repeat(item.rating)}
                  </div>
                )}
              </div>

              {/* Metric badges (for transformations) */}
              {item.metric && (
                <div class="flex gap-3 mb-4">
                  <div class="bg-white/5 rounded-lg p-3 flex-1 text-center">
                    <p class="font-bold text-lg" style="color: var(--color-accent, #ccff00);">
                      {item.metric.value}
                    </p>
                    <p class="text-[10px] text-[var(--color-text-muted)] uppercase">
                      {item.metric.label}
                    </p>
                  </div>
                  {item.duration && (
                    <div class="bg-white/5 rounded-lg p-3 flex-1 text-center">
                      <p class="font-bold text-lg text-white">{item.duration}</p>
                      <p class="text-[10px] text-[var(--color-text-muted)] uppercase">Duration</p>
                    </div>
                  )}
                </div>
              )}

              {/* Quote */}
              <p class="text-sm text-[var(--color-text-secondary)] italic leading-relaxed flex-grow">
                "{item.content}"
              </p>
            </div>
          ))}
        </div>
      ) : (
        <div class="flex gap-5 overflow-x-auto pb-4 snap-x snap-mandatory scroll-container" id="proof-carousel">
          {reviewCards.map((item: any) => (
            <div class="min-w-[300px] max-w-[340px] md:min-w-[380px] md:max-w-[400px] glass-card accent-hover p-6 rounded-[var(--radius-2xl,24px)] snap-start flex-shrink-0 flex flex-col">
              {/* Author - no image, just name badge */}
              <div class="flex items-center justify-between mb-5">
                <div>
                  <p class="text-white font-bold text-base">{item.author}</p>
                  <p class="text-xs text-[var(--color-text-muted)]">{item.role}</p>
                </div>
                {item.rating && (
                  <div class="text-[var(--color-accent)] text-sm">
                    {'★'.repeat(item.rating)}
                  </div>
                )}
              </div>

              {/* Metric badges (for transformations) */}
              {item.metric && (
                <div class="flex gap-3 mb-4">
                  <div class="bg-white/5 rounded-lg p-3 flex-1 text-center">
                    <p class="font-bold text-lg" style="color: var(--color-accent, #ccff00);">
                      {item.metric.value}
                    </p>
                    <p class="text-[10px] text-[var(--color-text-muted)] uppercase">
                      {item.metric.label}
                    </p>
                  </div>
                  {item.duration && (
                    <div class="bg-white/5 rounded-lg p-3 flex-1 text-center">
                      <p class="font-bold text-lg text-white">{item.duration}</p>
                      <p class="text-[10px] text-[var(--color-text-muted)] uppercase">Duration</p>
                    </div>
                  )}
                </div>
              )}

              {/* Quote */}
              <p class="text-sm text-[var(--color-text-secondary)] italic leading-relaxed flex-grow">
                "{item.content}"
              </p>
            </div>
          ))}
        </div>
      )}
    </div>
  </div>
</section>

<script>
  // Simple carousel navigation
  const carousel = document.getElementById('proof-carousel');
  const prevBtn = document.getElementById('proof-prev');
  const nextBtn = document.getElementById('proof-next');
  
  if (carousel && prevBtn && nextBtn) {
    const scrollAmount = 360;
    
    prevBtn.addEventListener('click', () => {
      carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
    });
    
    nextBtn.addEventListener('click', () => {
      carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
    });
  }
</script>
